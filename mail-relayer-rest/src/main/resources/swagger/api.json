{
  "openapi": "3.0.1",
  "info": {
    "title": "mailrelayer",
    "version": "0.0.1",
    "description": "Servicio de envío de correos para uso de aplicaciones de CONACYT.\nEnvía los correos electrónicos hacia un servidor SMTP que otorga permisos de retransmisión a este servicio basado en IP.",
    "contact": {
      "name": "Roberto Villarejo Martínez",
      "email": "roberto.villarejo@comimsa.com"
    },
    "license": {
      "name": "MIT License",
      "url": "https://opensource.org/licenses/MIT"
    }
  },
  "servers": [
    {
      "url": "http://mailrelayer:8081/api",
      "description": "Development server"
    },
    {
      "url": "https://mailrelayer:8081/api",
      "description": "Development server with TLS Profile"
    }
  ],
  "paths": {
    "/emails": {
      "summary": "Envío de correos electrónicos",
      "post": {
        "requestBody": {
          "description": "El correo electrónico a enviar.",
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/Email"
              }
            }
          },
          "required": true
        },
        "tags": ["email"],
        "parameters": [
          {
            "name": "async",
            "description": "Indica si se desea enviar de forma asíncrona.",
            "schema": {
              "type": "boolean"
            },
            "in": "query"
          }
        ],
        "responses": {
          "201": {
            "description": "Se envió el correo electrónico."
          },
          "202": {
            "description": "Se encoló el correo electrónico para su envío."
          },
          "400": {
            "description": "Error en la petición."
          }
        },
        "security": [
          {
            "ApiKey": []
          }
        ],
        "operationId": "sendEmail",
        "summary": "Envía un correo electrónico",
        "description": "Envía un correo electrónico."
      }
    },
    "/users": {
      "summary": "Administración de usuarios",
      "post": {
        "requestBody": {
          "description": "La información del usuario a registrar.",
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/UserRegistration"
              },
              "examples": {
                "NewUser": {
                  "value": {
                    "name": "awesomeApp"
                  }
                }
              }
            }
          },
          "required": true
        },
        "responses": {
          "201": {
            "description": "Se ha creado el usuario."
          }
        },
        "security": [
          {
            "oauth": ["master", "email", "profile"],
            "openId": []
          }
        ],
        "operationId": "registerUser",
        "summary": "Registra un usuario."
      }
    },
    "/users/{name}": {
      "summary": "Administra la información de un usuario.",
      "description": "Administra la información del usuario con nombre especificado.",
      "get": {
        "parameters": [
          {
            "name": "name",
            "description": "El nombre del usuario.",
            "schema": {
              "type": "string"
            },
            "in": "path",
            "required": true
          }
        ],
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/User"
                }
              }
            },
            "description": "Consulta exitosa."
          }
        },
        "operationId": "getUserByName",
        "summary": "Consuilta la información del usuario",
        "description": "Consulta la información del usuario con el nombre especificado."
      }
    }
  },
  "components": {
    "schemas": {
      "Email": {
        "title": "Root Type for Email",
        "description": "Un correo electrónico",
        "required": ["subject", "to", "sender"],
        "type": "object",
        "properties": {
          "to": {
            "description": "Lista de destinatarios.",
            "type": "array",
            "items": {
              "type": "string"
            }
          },
          "subject": {
            "description": "El asunto del correo.",
            "type": "string"
          },
          "plain_body": {
            "description": "Cuerpo del mensaje en texto plano.",
            "type": "string"
          },
          "cc": {
            "description": "Lista de destinatarios a los que se les envía copia del correo.",
            "type": "array",
            "items": {
              "type": "string"
            }
          },
          "bcc": {
            "description": "Lista de destinatarios ocultos a los que se les envía copia del correo.",
            "type": "array",
            "items": {
              "type": "string"
            }
          },
          "reply_to": {
            "description": "Dirección de correo de electrónico a la que el/los destinatarios pueden responder.",
            "type": "string"
          },
          "sender": {
            "description": "La dirección de correo electrónico desde donde se envía el mensaje.",
            "type": "string"
          },
          "html_body": {
            "description": "Cuerpo del mensaje en HTML.",
            "type": "string"
          },
          "attachments": {
            "description": "Lista de archivos adjuntos codificados en base 64.",
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/Attachment"
            }
          }
        },
        "example": {
          "to": ["user@example.com"],
          "cc": ["userCC@example.com"],
          "bcc": ["userBCC@example.com"],
          "reply_to": "reply_to@example.com",
          "sender": "sender@example.com",
          "subject": "Asunto del mensaje",
          "plain_body": "Cuerpo del mensaje en texto plano",
          "html_body": "<html><h1>Cuerpo del mensaje en HTML</h1></html>",
          "attachments": [
            {
              "filename": "documento.pdf",
              "content_type": "application/pdf",
              "data": "adjuntoEnBase64"
            }
          ]
        }
      },
      "UserRegistration": {
        "title": "Root Type for User",
        "description": "La información requerida para el registro de un usuario.",
        "type": "object",
        "properties": {
          "name": {
            "type": "string"
          }
        },
        "example": {
          "name": "awesomeApp"
        }
      },
      "User": {
        "title": "Root Type for User",
        "description": "Un usuario.",
        "type": "object",
        "properties": {
          "name": {
            "description": "El nombre del usuario.",
            "type": "string"
          },
          "apiKey": {
            "description": "La API key que utiliza para autenticarse.",
            "type": "string"
          }
        },
        "example": {
          "name": "Bob",
          "apiKey": "abc123abc123abc123abc123"
        }
      },
      "Attachment": {
        "title": "Root Type for Attachment",
        "description": "Un archivo adjunto.",
        "type": "object",
        "properties": {
          "filename": {
            "type": "string"
          },
          "content_type": {
            "type": "string"
          },
          "data": {
            "type": "string"
          }
        },
        "example": {
          "filename": "documento.pdf",
          "content_type": "application/pdf",
          "data": "contenidoEnBase64"
        }
      }
    },
    "responses": {
      "Problem": {
        "content": {
          "application/problem+json": {
            "schema": {
              "$ref": "https://opensource.zalando.com/problem/schema.yaml#/Problem"
            }
          }
        },
        "description": "error occurred - see status code and problem object for more information."
      }
    },
    "securitySchemes": {
      "oauth": {
        "flows": {
          "authorizationCode": {
            "authorizationUrl": "https://idm.crip.conacyt.mx/auth/realms/master/protocol/openid-connect/auth",
            "tokenUrl": "https://idm.crip.conacyt.mx/auth/realms/master/protocol/openid-connect/token",
            "scopes": {
              "master": "master specific claims",
              "email": "Email claims",
              "profile": "Profile claims"
            }
          }
        },
        "type": "oauth2",
        "description": "OAuth2 authentication with KeyCloak"
      },
      "openId": {
        "openIdConnectUrl": "https://idm.crip.conacyt.mx/auth/realms/master/.well-known/openid-configuration",
        "type": "openIdConnect",
        "description": "OpenID Connect authentication with KeyCloak"
      },
      "ApiKey": {
        "type": "apiKey",
        "description": "Token de API",
        "name": "X-API-KEY",
        "in": "header"
      }
    }
  },
  "security": [
    {
      "oauth": ["master", "email", "profile"]
    },
    {
      "openId": ["master", "email", "profile"]
    }
  ]
}
